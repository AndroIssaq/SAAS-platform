===============================================================================
  Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: Ù…Ø´ÙƒÙ„Ø© Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø´Ø±ÙŠÙƒ
===============================================================================

Date: November 3, 2025, 8:17 AM

===============================================================================
  Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
===============================================================================

Ø¹Ù†Ø¯ Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø´Ø±ÙŠÙƒ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚Ø¯ -> Ø§Ù„Ù…Ø¯ÙŠØ± ÙŠÙˆØ§ÙÙ‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø®Ø·Ø£!)

===============================================================================
  Ø§Ù„Ø­Ù„ - ÙŠØ¬Ø¨ ØªÙ†ÙÙŠØ° Ø®Ø·ÙˆØªÙŠÙ†
===============================================================================

Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ´ØºÙŠÙ„ Database Migration (Ø§Ù„Ø£Ù‡Ù…!)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Ø§Ù„Ù…Ù„Ù: database/migrations/add_affiliate_workflow_support.sql

ÙƒÙŠÙÙŠØ© Ø§Ù„ØªÙ†ÙÙŠØ°:

1. Ø§ÙØªØ­ Supabase Dashboard
   https://supabase.com/dashboard

2. Ø§Ø®ØªØ± Ù…Ø´Ø±ÙˆØ¹Ùƒ

3. Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -> SQL Editor

4. Ø§Ù†Ù‚Ø± "New Query"

5. Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù: database/migrations/add_affiliate_workflow_support.sql

6. Ø§Ù†Ø³Ø® ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (157 Ø³Ø·Ø±)

7. Ø§Ù„ØµÙ‚ ÙÙŠ SQL Editor

8. Ø§Ù†Ù‚Ø± "Run" Ø£Ùˆ Ctrl+Enter

9. Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠÙƒØªÙ…Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°

10. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©:
    âœ“ Success: Rows affected: 0 (Ù‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ)
    âŒ Error: Ø§Ù‚Ø±Ø£ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙˆØ£ØµÙ„Ø­Ù‡Ø§

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø¬Ø§Ø­ Migration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ÙÙŠ Ù†ÙØ³ SQL EditorØŒ Ø´ØºÙ‘Ù„ Ù‡Ø°Ø§:

  SELECT column_name, data_type, is_nullable
  FROM information_schema.columns 
  WHERE table_name = 'contracts' 
  AND column_name IN (
    'affiliate_review_approved',
    'current_step_name'
  )
  ORDER BY column_name;

Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:

  column_name               | data_type | is_nullable
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  affiliate_review_approved | boolean   | YES
  current_step_name         | text      | YES

Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª Ù‡Ø§ØªØ§Ù† Ø§Ù„ØµÙØ§Ù† -> Migration Ù†Ø¬Ø­ âœ“
Ø¥Ø°Ø§ Ù„Ù… ØªØ¸Ù‡Ø± -> Migration ÙØ´Ù„ØŒ Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© âŒ

===============================================================================
  Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ù„
===============================================================================

Ø¨Ø¹Ø¯ ØªØ´ØºÙŠÙ„ Migration:

1. Ø£Ù†Ø´Ø¦ Ø¹Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ affiliate_id

2. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙƒØ´Ø±ÙŠÙƒ

3. Ø§ÙØªØ­ Ø§Ù„Ø¹Ù‚Ø¯

4. ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚Ø¯

5. Ø§ÙØªØ­ Browser Console (F12)

6. Ø§Ø¨Ø­Ø« Ø¹Ù†:
   ğŸ” DEBUG - Saving to database:

7. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:
   {
     action: "AFFILIATE_REVIEW_APPROVED",
     participant: "affiliate",
     updateData: {
       affiliate_review_approved: true,  â† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† true
       admin_review_approved: false,     â† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† false
       ...
     }
   }

8. ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:
   
   ÙÙŠ SQL Editor:
   
   SELECT 
     contract_number,
     admin_review_approved,
     client_review_approved,
     affiliate_review_approved
   FROM contracts 
   WHERE id = 'YOUR_CONTRACT_ID';

   Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:
   admin_review_approved:     false
   client_review_approved:    false
   affiliate_review_approved: true  â† ØµØ­ÙŠØ­!

9. Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ±

10. ØªØ­Ù‚Ù‚ Ø£Ù† Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù… ÙŠÙˆØ§ÙÙ‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹

11. ÙˆØ§ÙÙ‚ ÙƒÙ…Ø¯ÙŠØ±

12. ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø© Ø£Ø®Ø±Ù‰:
    
    admin_review_approved:     true  â† Ø§Ù„Ø¢Ù† ØµØ­ÙŠØ­
    client_review_approved:    false
    affiliate_review_approved: true

===============================================================================
  Ù„Ù…Ø§Ø°Ø§ Ø­Ø¯Ø«Øª Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŸ
===============================================================================

Ø§Ù„Ø³Ø¨Ø¨: Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¹Ù…ÙˆØ¯ affiliate_review_approved

Ø§Ù„ØªØ³Ù„Ø³Ù„:

1. Ø§Ù„Ø´Ø±ÙŠÙƒ ÙŠÙˆØ§ÙÙ‚
2. Ø§Ù„ÙƒÙˆØ¯ ÙŠØ­Ø§ÙˆÙ„ Ø­ÙØ¸: affiliate_review_approved = true
3. Supabase ÙŠØ±ÙØ¶ Ù„Ø£Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯
4. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§ ØªÙØ­ÙØ¸
5. Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©ØŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø© Ø£Ùˆ Ù‚Ø¯ÙŠÙ…Ø©
6. Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹ØªÙ‚Ø¯ Ø£Ù† Ø§Ù„Ù…Ø¯ÙŠØ± ÙˆØ§ÙÙ‚ (Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©)

Ø§Ù„Ø­Ù„: Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø¹Ø¨Ø± Migration

===============================================================================
  Ø§Ù„ÙƒÙˆØ¯ ØµØ­ÙŠØ­ - Ù„Ø§ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨
===============================================================================

Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ØµØ­ÙŠØ­Ø© 100%:

âœ“ lib/contract-flow/flow-state-machine.ts
  - Lines 245-253: Ù…Ù†Ø·Ù‚ ØµØ­ÙŠØ­
  - ÙŠØ³ØªØ®Ø¯Ù… participant Ø§Ù„ÙØ¹Ù„ÙŠ

âœ“ lib/stores/contract-flow-store.ts
  - Lines 190-206: Ø­ÙØ¸ ØµØ­ÙŠØ­
  - Lines 454-456: mapping ØµØ­ÙŠØ­
  - Lines 379-381: Ù‚Ø±Ø§Ø¡Ø© ØµØ­ÙŠØ­Ø©

âœ“ app/actions/contracts.ts
  - Lines 184-209: notifications ØµØ­ÙŠØ­Ø©

Ù„Ø§ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø·Ù„ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯!

===============================================================================
  Debug Logs Ø§Ù„Ù…Ø¶Ø§ÙØ©
===============================================================================

ØªÙ… Ø¥Ø¶Ø§ÙØ© console.log ÙÙŠ:
  File: lib/stores/contract-flow-store.ts
  Lines: 193-200

Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Console:
  ğŸ” DEBUG - Saving to database: {
    contractId: "xxx",
    action: "AFFILIATE_REVIEW_APPROVED",
    participant: "affiliate",
    updateData: { ... },
    stepState: { ... }
  }

Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸

===============================================================================
  Ø§Ù„Ø®Ù„Ø§ØµØ©
===============================================================================

Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­ØªØ§Ø¬ Migration
Ø§Ù„Ø­Ù„: Ø´ØºÙ‘Ù„ add_affiliate_workflow_support.sql ÙÙŠ Supabase
Ø§Ù„Ù†ØªÙŠØ¬Ø©: Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø³ØªØ®ØªÙÙŠ ØªÙ…Ø§Ù…Ø§Ù‹

Ø§Ù„ÙƒÙˆØ¯ ØµØ­ÙŠØ­ âœ“
Ø§Ù„Ù…Ù†Ø·Ù‚ ØµØ­ÙŠØ­ âœ“
Migration Ø¬Ø§Ù‡Ø² âœ“

ÙÙ‚Ø· Ø´ØºÙ‘Ù„ Ø§Ù„Ù€ SQL!

===============================================================================
